import{_ as s,o as a,c as n,X as l}from"./chunks/framework.b5656a4e.js";const o="/assets/image-20221108161305062.b9a7b66a.png",d=JSON.parse('{"title":"docker","description":"","frontmatter":{},"headers":[],"relativePath":"data/部署/docker.md","filePath":"data/部署/docker.md","lastUpdated":1699253775000}'),p={name:"data/部署/docker.md"},e=l(`<h1 id="docker" tabindex="-1">docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;docker&quot;">​</a></h1><h2 id="基础" tabindex="-1">基础 <a class="header-anchor" href="#基础" aria-label="Permalink to &quot;基础&quot;">​</a></h2><p>开源容器解决方案，高效、轻量、可移植<br><a href="https://docs.docker.com/" target="_blank" rel="noreferrer">https://docs.docker.com/</a></p><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">启动docker服务 systemctl start docker</span></span>
<span class="line"><span style="color:#A6ACCD;">重启docker服务 systemctl restart docker</span></span>
<span class="line"><span style="color:#A6ACCD;">启动docker服务旧版本 service docker start</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">docker查看日志 docker logs -f -t --tail 10 ca</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">查看镜像 docker images</span></span>
<span class="line"><span style="color:#A6ACCD;">获取镜像 docker pull ubuntu:13.10</span></span>
<span class="line"><span style="color:#A6ACCD;">查找镜像 docker search httpd</span></span>
<span class="line"><span style="color:#A6ACCD;">运行镜像 docker run httpd</span></span>
<span class="line"><span style="color:#A6ACCD;">删除镜像 docker rmi hello-world</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">查看正在运行的容器 docker ps</span></span>
<span class="line"><span style="color:#A6ACCD;">查看所有的容器 docker ps -a </span></span>
<span class="line"><span style="color:#A6ACCD;">启动容器 docker start b750bbbcfd88 </span></span>
<span class="line"><span style="color:#A6ACCD;">重启容器 docker restart b750bbbcfd88 </span></span>
<span class="line"><span style="color:#A6ACCD;">停止容器 docker stop b750bbbcfd88</span></span>
<span class="line"><span style="color:#A6ACCD;">删除容器 </span></span>
<span class="line"><span style="color:#A6ACCD;">   docker rm -f 1e560fca3906</span></span>
<span class="line"><span style="color:#A6ACCD;">   docker container rm  &lt;container ID&gt; </span></span>
<span class="line"><span style="color:#A6ACCD;">查看容器信息 docker inspect 容器名</span></span>
<span class="line"><span style="color:#A6ACCD;">进入后台容器 docker exec -it 243c32535da7 /bin/bash </span></span>
<span class="line"><span style="color:#A6ACCD;">退出容器 exit </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">根据镜像创建容器 docker run -d --name=testtong --restart=always -p 8011:8080 registry.cn-shanghai.aliyuncs.com/kufang/daservice</span></span>
<span class="line"><span style="color:#A6ACCD;">根据已有镜像创建容器 docker container run -it -d -p 82:80 --name testtong 1dbc90bf1e40</span></span>
<span class="line"><span style="color:#A6ACCD;">参考 &lt;https://www.jianshu.com/p/6a9b07c92995&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">docker文件拷贝到宿主机 </span></span>
<span class="line"><span style="color:#A6ACCD;">   docker cp testtomcat：/usr/local/tomcat/webapps/test/js/test.js  /opt</span></span>
<span class="line"><span style="color:#A6ACCD;">   docker cp daservice:/usr/local/share/tessdata /root/tong/laji</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">docker 查看挂载目录：docker inspect container_name | grep Mounts -A 20</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">停止所有容器 docker stop $(docker ps -aq)</span></span>
<span class="line"><span style="color:#A6ACCD;">开始所有容器 docker rm $(docker ps -aq)</span></span>
<span class="line"><span style="color:#A6ACCD;">清理掉处于终止状态的容器 docker container prune</span></span>
<span class="line"><span style="color:#A6ACCD;">后台运行的容器 docker run -itd --name ubuntu-test ubuntu /bin/bash </span></span>
<span class="line"><span style="color:#A6ACCD;">导出容器 docker export 1e560fca3906 &gt; ubuntu.tar </span></span>
<span class="line"><span style="color:#A6ACCD;">导入容器 cat docker/ubuntu.tar | docker import - test/ubuntu:v1</span></span>
<span class="line"><span style="color:#A6ACCD;">   镜像导入容器： docker import http://example.com/exampleimage.tgz example/imagerepo</span></span>
<span class="line"><span style="color:#A6ACCD;">web日志 docker logs -f bf08b7f2cd89</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">docker cp comonitor.war comonitor:/usr/share/apache-tomcat-7.0.96/webapps 会自动解压 </span></span>
<span class="line"><span style="color:#A6ACCD;">docker restart comonitor</span></span>
<span class="line"><span style="color:#A6ACCD;">docker exec -it 7453d7a061a0 /bin/bash </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">改镜像地址 vim  /etc/docker/daemon.json </span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="部署" tabindex="-1">部署 <a class="header-anchor" href="#部署" aria-label="Permalink to &quot;部署&quot;">​</a></h2><h3 id="dockerfile" tabindex="-1">dockerfile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;dockerfile&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker pull java:8u111</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 基于哪个镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM java:8</span></span>
<span class="line"><span style="color:#A6ACCD;"># 将本地文件夹挂载到当前容器</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME /tmp</span></span>
<span class="line"><span style="color:#A6ACCD;"># 拷贝文件到容器，handcuffs-reg-0.0.1-SNAPSHOT.jar这里是maven打包后的名字</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD dtcms-asset-alarm.jar dtcms-asset-alarm.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN bash -c &#39;touch /dtcms-asset-alarm.jar&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置容器启动后执行的命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT  [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/dtcms-asset-alarm.jar&quot;]</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[root@localhost test2]# ls</span></span>
<span class="line"><span style="color:#A6ACCD;">Dockerfile  einvoice.jar</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker build -t springbootdemo4docker .</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[root@localhost docker]# docker run -d -p 8080:8085 springbootdemo4docker</span></span>
<span class="line"><span style="color:#A6ACCD;">-d参数是让容器后台运行 </span></span>
<span class="line"><span style="color:#A6ACCD;">-p 是做端口映射，此时将服务器中的8080端口映射到容器中的8085(项目中端口配置的是8085)端口</span></span></code></pre></div><h3 id="docker部署war包" tabindex="-1">docker部署war包 <a class="header-anchor" href="#docker部署war包" aria-label="Permalink to &quot;docker部署war包&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">https://blog.csdn.net/xiaoye319/article/details/90515996</span></span>
<span class="line"><span style="color:#A6ACCD;">直接放容器里的webapp下(容器关闭可能war包会消失)，或者挂载目录到webapp</span></span>
<span class="line"><span style="color:#A6ACCD;">1、docker search tomcat 搜索镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">2、docker pull docker.io/tomcat 根据tomcat名称拉去镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">3、docker run -d -p 8088:8080 docker.io/tomcat 使用镜像启动容器</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">1、安装vim apt-get update &amp;&amp; apt-get install vim -y</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">2、dockerfile文件</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM 77be327e4b63 （这串数字是我已经创建好一个ubuntu镜像的镜像id，在这里作为tomcat的基础镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">MAINTAINER hmk</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV REFRESHED_AT 2020-04-14 </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#切换镜像目录，进入/usr目录</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR /usr</span></span>
<span class="line"><span style="color:#A6ACCD;">#在/usr/下创建jdk目录,用来存放jdk文件</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN mkdir jdk</span></span>
<span class="line"><span style="color:#A6ACCD;">#在/usr/下创建tomcat目录，用来存放tomcat</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN mkdir tomcat</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#将宿主机的jdk目录下的文件拷至镜像的/usr/jdk目录下</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD jdk1.8.0_231 /usr/jdk/</span></span>
<span class="line"><span style="color:#A6ACCD;">#将宿主机的tomcat目录下的文件拷至镜像的/usr/tomcat目录下</span></span>
<span class="line"><span style="color:#A6ACCD;">ADD apache-tomcat-9.0.34 /usr/tomcat/</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#设置环境变量</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JAVA_HOME=/usr/jdk</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JRE_HOME=$JAVA_HOME/jre</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV PATH=/sbin:$JAVA_HOME/bin:$PATH</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#公开端口</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8080</span></span>
<span class="line"><span style="color:#A6ACCD;">#设置启动命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT [&quot;/usr/tomcat/bin/catalina.sh&quot;,&quot;run&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">3、构建docker build -t tong/tomcat .</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">docker run -d --name=einvoice -e &quot;container=docker&quot; --restart=always -p 90:8080 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v /hosts:/etc/hosts \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v /cubedata/NFS_ts:/NFS_ts \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v /cubedata/logs/einvoice:/usr/share/tomcat/logs \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;TZ=Asia/Shanghai&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_FILEPARSER_DB_HOST=172.16.0.104&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_FILEPARSER_DB_PORT=3306&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_FILEPARSER_DB_TABLENAME=fileparser&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_FILEPARSER_DB_USERNAME=root&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_FILEPARSER_DB_PASSWORD=ssmedia-11&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;CUBESERVICE_DB_HOST=172.16.0.104&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;CUBESERVICE_DB_PORT=3306&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;CUBESERVICE_DB_TABLENAME=einvoice&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;CUBESERVICE_DB_USERNAME=root&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;CUBESERVICE_DB_PASSWORD=ssmedia-11&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_HOST=172.16.0.104&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_PORT=80&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;DASERVICE_ANALYSIS=analysis.do&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;REDIS_HOST=172.16.0.104&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;REDIS_PASSWORD=ssmedia-11&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;REDIS_TIMEOUT=2000&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e &quot;EINVOICE_IP=172.16.0.104:90&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">registry.cn-shanghai.aliyuncs.com/kufang/einvoice:1.15.0T</span></span></code></pre></div><h3 id="项目案例" tabindex="-1">项目案例 <a class="header-anchor" href="#项目案例" aria-label="Permalink to &quot;项目案例&quot;">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">daservice </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">container=docker</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">privileged</span><span style="color:#89DDFF;">=true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">device </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">dev</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">mem </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">always </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">84</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">8070</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hosts</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hosts \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">ticketparser</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">ticketparser \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts2</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts2 \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">daservice</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logs \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">TZ=Asia/Shanghai</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">daservice</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">2.1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">2T</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">testtong </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">always </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">8011</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">daservice</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">查看images创建命令</span></span>
<span class="line"><span style="color:#A6ACCD;">docker history registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">einvoice</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">2.0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0T </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">docker history registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">einvoice</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">2.0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0T </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">trunc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">docker history registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">einvoice</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">2.0</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0T </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">no</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">trunc</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 部署comonitor服务dockerfile文件例子</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">docker run </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">comonitor </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">container=docker</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">privileged</span><span style="color:#89DDFF;">=true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">device </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">dev</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">mem </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">restart</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">always </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">87</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hosts</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">etc</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">hosts \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">data_3D</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts2</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">NFS_ts2 \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">v </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">data_3D</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">comonitor</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">usr</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">share</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">tomcat</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">logs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">TZ=Asia/Shanghai</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_FILEPARSER_DB_HOST=172.16.0.104</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_FILEPARSER_DB_PORT=3306</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_FILEPARSER_DB_TABLENAME=fileparser</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_FILEPARSER_DB_USERNAME=root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_FILEPARSER_DB_PASSWORD=ssmedia-11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DPS_DB_HOST=172.16.0.104</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DPS_DB_PORT=3306</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DPS_DB_TABLENAME=dps</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DPS_DB_USERNAME=root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DPS_DB_PASSWORD=ssmedia-11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_COMONITOR_DB_HOST=172.16.0.104</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_COMONITOR_DB_PORT=3306</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_COMONITOR_DB_TABLENAME=comonitor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_COMONITOR_DB_USERNAME=root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_COMONITOR_DB_PASSWORD=ssmedia-11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DMS_DB_HOST=172.16.0.104</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DMS_DB_PORT=3306</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DMS_DB_TABLENAME=dms</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DMS_DB_USERNAME=root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DASERVICE_DMS_DB_PASSWORD=ssmedia-11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MQTT_SERVER_URI=tcp://172.16.1.95:1883</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MQTT_SERVER_USER_NAME=counect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MQTT_SERVER_PASSWORD=123456</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">COMONITOR_URL=服务器入口地址/comonitor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cn</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">shanghai</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">aliyuncs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">com</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">kufang</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">comonitor</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#F78C6C;">0.7</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">1</span></span></code></pre></div><h2 id="底层原理" tabindex="-1">底层原理 <a class="header-anchor" href="#底层原理" aria-label="Permalink to &quot;底层原理&quot;">​</a></h2><p><strong>Docker是Client/Server架构。其中Docker守护进程是服务端，Docker命令行是众多客户端之一</strong></p><ol><li><p><strong>docker daemon</strong>Docker守护进程(docker daemon)是运行在你的操作系统上的一个服务。目前，它只能运行在Linux上，因为它依赖于一些Linux内核特性(比如Cgroup与Namespace)。 但是，也有一些特殊的办法让Docker运行在MacOS与Windows上(运行在Linux虚拟机中)。</p><p>Docker守护进程提供了REST API。许多工具(Docker命令行，Docker Compose等)都可以通过REST API与Docker守护进程进行交互，例如创建容器，构建镜像等。</p></li><li><p><strong>docker CLI</strong>Docker命令行(docker CLI)是与Docker守护进程进行交互的主要工具。</p></li></ol><p><img src="`+o+'" alt="image-20221108161305062"></p><h2 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to &quot;其他&quot;">​</a></h2><p><strong>一、占用空间</strong></p><p>/var/lib/docker/overlay2过大</p><p>/var/lib/docker/image/overlay2：存储镜像管理元数据的目录，以使用存储驱动命名。</p><p>/var/lib/docker/overlay2:　　docker镜像存储的联合挂载根目录</p><p><a href="https://blog.csdn.net/weixin_32820767/article/details/81196250" target="_blank" rel="noreferrer">https://blog.csdn.net/weixin_32820767/article/details/81196250</a></p><p><strong>二、网络模式</strong></p><p><strong>Docker Compose</strong></p><p><a href="https://www.cnblogs.com/zuxing/articles/8780661.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/zuxing/articles/8780661.html</a></p><p>docker network inspect bridge</p><p><strong>三、容器网络管理</strong></p><p>docker1.1 新特性--libnetwork模块</p><p>存储驱动之一 overlay2 管理卷 四种网络模式 brighe(默认网络。docker启动后，会默认创建一个docker0网桥，默认创建的容器也是添加到这个网桥中)</p>',36),t=[e];function c(r,D,C,A,y,i){return a(),n("div",null,t)}const u=s(p,[["render",c]]);export{d as __pageData,u as default};
